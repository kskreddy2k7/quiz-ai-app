<AIChatScreen>:
    canvas.before:
        Color:
            rgba: 0.05, 0.07, 0.12, 1
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: "vertical"
        padding: "20dp"
        spacing: "12dp"
        BoxLayout:
            size_hint_y: None
            height: "40dp"
            Button:
                text: "‚Üê Back"
                size_hint_x: None
                width: "90dp"
                background_normal: ""
                background_color: 0.16, 0.22, 0.3, 1
                on_release: app.go_home()
            Label:
                text: "AI Doubt Solver"
                color: 0.7, 0.9, 1, 1
                bold: True
        ScrollView:
            do_scroll_x: False
            Label:
                text: root.chat_history if root.chat_history else "Your tutor will respond here."
                color: 0.85, 0.9, 1, 0.9
                font_size: "14sp"
                text_size: self.width, None
                size_hint_y: None
                height: self.texture_size[1]
        Label:
            text: root.status_text
            font_size: "12sp"
            color: 0.6, 0.75, 0.9, 0.9
            size_hint_y: None
            height: self.texture_size[1]
        BoxLayout:
            size_hint_y: None
            height: "50dp"
            spacing: "10dp"
            TextInput:
                id: tutor_input
                hint_text: "Ask your question..."
                multiline: False
                background_normal: ""
                background_color: 0.1, 0.14, 0.2, 1
                foreground_color: 1, 1, 1, 1
                padding: "12dp", "12dp"
                cursor_color: 0.6, 0.85, 1, 1
            Button:
                text: "Send"
                size_hint_x: None
                width: "90dp"
                background_normal: ""
                background_color: 0.35, 0.55, 0.9, 1
                disabled: not app.ai_engine.is_available()
                opacity: 0.5 if self.disabled else 1
                on_release:
                    app.send_ai_question(tutor_input.text)
                    tutor_input.text = ""
