#:import Theme app.ui.theme.Theme


<ActionCard@GlassCard>:
    icon: ""
    title: ""
    subtitle: ""
    action: lambda: None
    padding: "0dp" # Reset padding for custom layout inside

    Button:
        background_normal: ""
        background_color: 0, 0, 0, 0
        on_release: root.action()
        
        BoxLayout:
            orientation: "vertical"
            padding: "16dp"
            spacing: "8dp"
            pos: self.parent.pos
            size: self.parent.size

            Label:
                text: root.icon
                font_size: "32sp"
                size_hint_y: None
                height: "40dp"
                halign: "left"
                text_size: self.size

            Label:
                text: root.title
                font_size: "18sp"
                bold: True
                color: Theme.color(Theme.TEXT_PRIMARY)
                size_hint_y: None
                height: "24dp"
                halign: "left"
                text_size: self.size
            
            Label:
                text: root.subtitle
                font_size: "12sp"
                color: Theme.color(Theme.TEXT_SECONDARY)
                halign: "left"
                valign: "top"
                text_size: self.size

<HomeScreen>:
    canvas.before:
        Color:
            rgba: Theme.color(Theme.BG_DARK)
        Rectangle:
            pos: self.pos
            size: self.size
        # Ambient Gradient Spots
        Color:
            rgba: Theme.color(Theme.SECONDARY, 0.15)
        Ellipse:
            pos: self.width - 200, self.height - 200
            size: 400, 400
        Color:
            rgba: Theme.color(Theme.PRIMARY, 0.1)
        Ellipse:
            pos: -100, -100
            size: 300, 300

    ScrollView:
        do_scroll_x: False
        BoxLayout:
            orientation: "vertical"
            padding: "20dp"
            spacing: "24dp"
            size_hint_y: None
            height: self.minimum_height

            # Header
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: "2dp"
                Label:
                    text: "DASHBOARD"
                    font_size: "12sp"
                    bold: True
                    color: Theme.color(Theme.ACCENT_TEAL)
                    size_hint_y: None
                    height: "16dp"
                    halign: "left"
                    text_size: self.width, None
                Label:
                    text: "Welcome Back"
                    font_size: Theme.FONT_H1
                    bold: True
                    color: Theme.color(Theme.TEXT_PRIMARY)
                    size_hint_y: None
                    height: "40dp"
                    halign: "left"
                    text_size: self.width, None

            # Daily Insight Card
            GlassCard:
                size_hint_y: None
                height: self.minimum_height
                
                Label:
                    text: "DAILY INSIGHT"
                    font_size: "11sp"
                    bold: True
                    color: Theme.color(Theme.SECONDARY)
                    size_hint_y: None
                    height: "16dp"
                    halign: "left"
                    text_size: self.width, None

                Label:
                    text: root.daily_quote
                    font_size: "15sp"
                    italic: True
                    color: Theme.color(Theme.TEXT_PRIMARY)
                    text_size: self.width, None
                    size_hint_y: None
                    height: self.texture_size[1]
                
                BoxLayout:
                    size_hint_y: None
                    height: "20dp"
                    spacing: "10dp"
                    Label:
                        text: root.streak_text
                        font_size: "12sp"
                        color: Theme.color(Theme.ACCENT_YELLOW)
                        size_hint_x: None
                        width: self.texture_size[0]
                    Label:
                        text: root.ai_status
                        font_size: "12sp"
                        color: root.ai_status_color
                        halign: "left"
                        text_size: self.size

            # Quick Actions Grid
            GridLayout:
                cols: 2
                spacing: "16dp"
                size_hint_y: None
                height: "510dp" # Adjusted for 3 rows

                # 1. Start AI Doubt Solver
                ActionCard:
                    icon: "ü§ñ"
                    title: "Ask AI"
                    subtitle: "Solve academic doubts"
                    action: lambda: app.go_ai_chat()

                # 2. File-Based Quiz
                ActionCard:
                    icon: "üìÇ"
                    title: "Quiz from File"
                    subtitle: "PDF / DOCX / TXT"
                    action: lambda: app.go_quiz_setup(mode="file")

                # 3. Topic-Based Quiz
                ActionCard:
                    icon: "‚úçÔ∏è"
                    title: "Quiz from Topic"
                    subtitle: "Subject & Topic"
                    action: lambda: app.go_quiz_setup(mode="topic")

                # 4. My Quizzes (History)
                ActionCard:
                    icon: "üß†"
                    title: "My Quizzes"
                    subtitle: "Saved quiz collection"
                    action: lambda: app.go_progress()

                # 5. Results & Analytics
                ActionCard:
                    icon: "üìä"
                    title: "Results"
                    subtitle: "Performance review"
                    action: lambda: app.go_results_overview() # New navigation method

                # 6. Settings
                ActionCard:
                    icon: "‚öôÔ∏è"
                    title: "Settings"
                    subtitle: "Manage API Keys"
                    action: lambda: app.open_settings()

            # Footer
            Label:
                text: root.permission_status
                font_size: "11sp"
                color: Theme.color(Theme.TEXT_SECONDARY)
                size_hint_y: None
                height: "20dp"
