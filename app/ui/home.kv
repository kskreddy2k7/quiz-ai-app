#:import Theme app.ui.theme.Theme
#:include app/ui/components.kv

<ActionCard@KVCard>:
    icon: ""
    title: ""
    subtitle: ""
    action: lambda: None
    padding: dp(0) # Reset padding for custom layout inside
    # Clickable behavior via transparent button overlay

    Button:
        background_normal: ""
        background_color: 0, 0, 0, 0
        on_release: root.action()
        
        BoxLayout:
            orientation: "vertical"
            padding: dp(16)
            spacing: dp(8)
            pos: self.parent.pos
            size: self.parent.size

            Label:
                text: root.icon
                font_size: "32sp"
                size_hint_y: None
                height: dp(40)
                halign: "left"
                text_size: self.size

            Label:
                text: root.title
                font_size: "18sp"
                bold: True
                font_name: Theme.FONT_HEADINGS
                color: Theme.get_color(Theme.TEXT_PRIMARY)
                size_hint_y: None
                height: dp(24)
                halign: "left"
                text_size: self.size
            
            Label:
                text: root.subtitle
                font_size: "12sp"
                font_name: Theme.FONT_BODY
                color: Theme.get_color(Theme.TEXT_SECONDARY)
                halign: "left"
                valign: "top"
                text_size: self.size

<HomeScreen>:
    FloatLayout:
        canvas.before:
            Color:
                rgba: Theme.get_color(Theme.BG_DARK)
            Rectangle:
                pos: self.pos
                size: self.size
            # Ambient Gradient Spots
            Color:
                rgba: Theme.get_color(Theme.ACCENT_PURPLE, 0.1)
            Ellipse:
                pos: self.width - dp(200), self.height - dp(200)
                size: dp(400), dp(400)
            Color:
                rgba: Theme.get_color(Theme.PRIMARY_START, 0.1)
            Ellipse:
                pos: -dp(100), -dp(100)
                size: dp(300), dp(300)

        ScrollView:
            do_scroll_x: False
            BoxLayout:
                orientation: "vertical"
                padding: dp(20)
                spacing: dp(24)
                size_hint_y: None
                height: self.minimum_height

                # Header
                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(2)
                    BoxLayout:
                        size_hint_y: None
                        height: dp(24)
                        
                        Label:
                            text: "DASHBOARD"
                            font_size: "12sp"
                            bold: True
                            font_name: Theme.FONT_BUTTON
                            color: Theme.get_color(Theme.ACCENT_CYAN)
                            size_hint_x: 1
                            halign: "left"
                            text_size: self.size
                            valign: "middle"

                        Button:
                            text: "üåê " + app.language
                            font_size: "12sp"
                            size_hint_x: None
                            width: dp(100)
                            background_normal: ""
                            background_color: 0,0,0,0
                            color: Theme.get_color(Theme.TEXT_SECONDARY)
                            on_release: app.cycle_language()
                            bold: True
                            valign: "middle"
                    Label:
                        text: "S Quiz"
                        font_size: dp(36)
                        bold: True
                        font_name: Theme.FONT_HEADINGS
                        color: Theme.get_color(Theme.TEXT_PRIMARY)
                        size_hint_y: None
                        height: dp(44)
                        halign: "left"
                        text_size: self.width, None
                    
                    Label:
                        text: "‚ú® Created by Sai ‚ú®"
                        font_size: "14sp"
                        font_name: Theme.FONT_BODY
                        color: Theme.get_color(Theme.ACCENT_PURPLE)
                        size_hint_y: None
                        height: dp(24)
                        halign: "left"
                        text_size: self.width, None

                # Daily Insight Card
                KVCard:
                    size_hint_y: None
                    height: self.minimum_height
                    
                    Label:
                        text: "DAILY INSIGHT"
                        font_size: "11sp"
                        bold: True
                        font_name: Theme.FONT_BUTTON
                        color: Theme.get_color(Theme.ACCENT_PURPLE)
                        size_hint_y: None
                        height: dp(16)
                        halign: "left"
                        text_size: self.width, None

                    Label:
                        text: root.daily_quote
                        font_size: "15sp"
                        italic: True
                        font_name: Theme.FONT_BODY
                        color: Theme.get_color(Theme.TEXT_PRIMARY)
                        text_size: self.width, None
                        size_hint_y: None
                        height: self.texture_size[1]
                    
                    BoxLayout:
                        size_hint_y: None
                        height: dp(20)
                        spacing: dp(10)
                        Label:
                            text: root.streak_text
                            font_size: "12sp"
                            color: Theme.get_color(Theme.TEXT_SUCCESS) # Used Success for streak
                            size_hint_x: None
                            width: self.texture_size[0]
                        Label:
                            text: root.ai_status
                            font_size: "12sp"
                            color: root.ai_status_color
                            halign: "left"
                            text_size: self.size

                # Quick Actions Grid
                GridLayout:
                    cols: 2
                    spacing: dp(16)
                    size_hint_y: None
                    height: dp(540) # Approximate height for 3 rows

                    # 1. Start AI Doubt Solver
                    ActionCard:
                        icon: "ü§ñ"
                        title: "Ask AI"
                        subtitle: "Solve academic doubts"
                        action: lambda: app.go_ai_chat()

                    # 2. File-Based Quiz
                    ActionCard:
                        icon: "üìÇ"
                        title: "Quiz from File"
                        subtitle: "PDF / DOCX / TXT"
                        action: lambda: app.go_quiz_setup(mode="file")

                    # 3. Topic-Based Quiz
                    ActionCard:
                        icon: "‚úçÔ∏è"
                        title: "Quiz from Topic"
                        subtitle: "Subject & Topic"
                        action: lambda: app.go_quiz_setup(mode="topic")

                    # 4. My Quizzes (History)
                    ActionCard:
                        icon: "üß†"
                        title: "My Quizzes"
                        subtitle: "Saved quiz collection"
                        action: lambda: app.go_progress()

                    # 5. Results & Analytics
                    ActionCard:
                        icon: "üìä"
                        title: "Results"
                        subtitle: "Performance review"
                        action: lambda: app.go_results_overview()

                    # 6. Settings
                    ActionCard:
                        icon: "‚öôÔ∏è"
                        title: "Settings"
                        subtitle: "Manage API Keys"
                        action: lambda: app.open_settings()

        # Footer Status
        Label:
            text: root.permission_status
            font_size: "11sp"
            color: Theme.get_color(Theme.TEXT_SECONDARY)
            size_hint: None, None
            size: self.texture_size
            pos_hint: {"center_x": 0.5, "y": 0.02}

        # Floating AI Button
        Button:
            text: "AI"
            font_size: "18sp"
            bold: True
            font_name: Theme.FONT_BUTTON
            size_hint: None, None
            size: dp(56), dp(56)
            pos_hint: {"right": 0.95, "y": 0.05}
            background_color: 0,0,0,0
            on_release: app.go_ai_chat()
            canvas.before:
                Color:
                    rgba: Theme.get_color(Theme.PRIMARY_START)
                Ellipse:
                    pos: self.pos
                    size: self.size
                # Glow
                Color:
                    rgba: Theme.get_color(Theme.PRIMARY_START, 0.4)
                Ellipse:
                    pos: self.x - dp(4), self.y - dp(4)
                    size: self.width + dp(8), self.height + dp(8)
