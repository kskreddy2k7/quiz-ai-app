#:import Theme app.ui.theme.Theme
#:include app/ui/components.kv

<ProgressScreen>:
    canvas.before:
        Color:
            rgba: Theme.get_color(Theme.BG_DARK)
        Rectangle:
            pos: self.pos
            size: self.size
        # Bottom Glow
        Color:
            rgba: Theme.get_color(Theme.ACCENT_TEAL, 0.1)
        Ellipse:
            pos: 0, -dp(200)
            size: self.width, dp(400)

    BoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(20)

        # --- Header ---
        BoxLayout:
            size_hint_y: None
            height: dp(48)
            spacing: dp(12)
            # Back Button
            Button:
                text: "‚Üê"
                size_hint: None, None
                size: dp(44), dp(44)
                background_normal: ""
                background_color: 0,0,0,0
                font_name: Theme.FONT_HEADINGS
                font_size: "24sp"
                color: Theme.get_color(Theme.TEXT_SECONDARY)
                on_release: app.go_home()
                canvas.before:
                    Color:
                        rgba: Theme.get_color(Theme.CARD_DARK)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(12)]

            Label:
                text: "YOUR JOURNEY"
                font_size: Theme.H2_SIZE
                bold: True
                font_name: Theme.FONT_HEADINGS
                color: Theme.get_color(Theme.TEXT_PRIMARY)
                halign: "left"
                valign: "middle"
                text_size: self.size

        ScrollView:
            do_scroll_x: False
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(20)

                # --- Stats Row ---
                BoxLayout:
                    size_hint_y: None
                    height: dp(120)
                    spacing: dp(16)

                    # Average Score
                    KVCard:
                        padding: dp(16)
                        Label:
                            text: "AVG SCORE"
                            font_size: "10sp"
                            color: Theme.get_color(Theme.SECONDARY)
                            size_hint_y: None
                            height: dp(16)
                            font_name: Theme.FONT_BUTTON
                        Label:
                            text: str(root.average_score) + "%"
                            font_size: "36sp"
                            bold: True
                            color: Theme.get_color(Theme.ACCENT_CYAN)
                            font_name: Theme.FONT_HEADINGS

                    # Streak
                    KVCard:
                        padding: dp(16)
                        Label:
                            text: "STREAK"
                            font_size: "10sp"
                            color: Theme.get_color(Theme.ACCENT_YELLOW)
                            size_hint_y: None
                            height: dp(16)
                            font_name: Theme.FONT_BUTTON
                        Label:
                            text: root.streak_text.replace("Streak: ", "").replace(" days", "") + " üî•"
                            font_size: "36sp"
                            bold: True
                            color: Theme.get_color(Theme.ACCENT_YELLOW)
                            font_name: Theme.FONT_HEADINGS

                # --- History Section ---
                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height
                    spacing: dp(12)
                    
                    Label:
                        text: "RECENT ACTIVITY"
                        font_size: "12sp"
                        bold: True
                        font_name: Theme.FONT_BUTTON
                        color: Theme.get_color(Theme.TEXT_SECONDARY)
                        size_hint_y: None
                        height: dp(20)
                        halign: "left"
                        text_size: self.width, None

                    KVCard:
                        size_hint_y: None
                        height: max(self.minimum_height, dp(200))
                        padding: dp(20)
                        
                        Label:
                            text: root.history_text
                            font_size: "14sp"
                            line_height: 1.6
                            color: Theme.get_color(Theme.TEXT_PRIMARY)
                            size_hint_y: None
                            height: self.texture_size[1]
                            halign: "left"
                            valign: "top"
                            text_size: self.width, None
                            font_name: Theme.FONT_BODY
