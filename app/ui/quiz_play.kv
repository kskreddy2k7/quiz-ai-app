#:import Theme app.ui.theme.Theme
#:include app/ui/components.kv

<QuizOptionWidget>:
    size_hint_y: None
    height: dp(64)
    padding: dp(0)
    
    canvas.before:
        Color:
            rgba: root.bg_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(16)]
        # Border
        Color:
            rgba: Theme.get_color(Theme.PRIMARY_START, 0.5)
        Line:
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(16)]
            width: dp(1)

    Label:
        text: root.text
        text_size: self.width - dp(32), None
        size_hint_x: 1
        padding: dp(16), dp(0)
        halign: "left"
        valign: "middle"
        font_name: Theme.FONT_BODY
        color: Theme.get_color(Theme.TEXT_PRIMARY)
        font_size: "15sp"

<QuizPlayScreen>:
    canvas.before:
        Color:
            rgba: Theme.get_color(Theme.BG_DARK)
        Rectangle:
            pos: self.pos
            size: self.size
        # Background Detail
        Color:
            rgba: Theme.get_color(Theme.PRIMARY_START, 0.05)
        Ellipse:
            pos: -dp(200), -dp(200)
            size: dp(500), dp(500)

    BoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(20)

        # --- Top Bar ---
        BoxLayout:
            size_hint_y: None
            height: dp(50)
            canvas.before:
                Color:
                    rgba: Theme.get_color(Theme.CARD_DARK, 0.4)
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(12)]
            
            Button:
                text: "×"
                font_name: Theme.FONT_HEADINGS
                font_size: "24sp"
                size_hint: None, None
                size: dp(50), dp(50)
                background_normal: ""
                background_color: 0,0,0,0
                color: Theme.get_color(Theme.TEXT_ERROR)
                on_release: app.go_home()
            
            Label:
                text: root.progress_text
                font_size: "16sp"
                bold: True
                font_name: Theme.FONT_BUTTON
                color: Theme.get_color(Theme.PRIMARY_START)
                halign: "right"
                valign: "middle"
                padding: dp(16), 0
                text_size: self.size

        # --- Question Card ---
        KVCard:
            size_hint_y: None
            height: self.minimum_height
            padding: dp(24)
            
            Label:
                text: root.question_text
                font_size: "20sp"
                bold: True
                font_name: Theme.FONT_HEADINGS
                line_height: 1.3
                color: Theme.get_color(Theme.TEXT_PRIMARY)
                text_size: self.width, None
                size_hint_y: None
                height: self.texture_size[1]
                halign: "center"

        # --- Options List ---
        ScrollView:
            do_scroll_x: False
            GridLayout:
                id: options_container
                cols: 1
                spacing: dp(16)
                size_hint_y: None
                height: self.minimum_height
                padding: [0, dp(10), 0, dp(10)]

        # --- Submit Action ---
        PrimaryButton:
            id: submit_btn
            text: "Submit Answer ⚡"
            size_hint_y: None
            height: dp(56)
            disabled: True
            opacity: 0.5 if self.disabled else 1
            on_release: root.submit_selection()
