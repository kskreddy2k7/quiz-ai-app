#:import Theme app.ui.theme.Theme


<ResultsScreen>:
    canvas.before:
        Color:
            rgba: Theme.color(Theme.BG_DARK)
        Rectangle:
            pos: self.pos
            size: self.size
        # Victory Burst (Centered)
        Color:
            rgba: Theme.color(Theme.PRIMARY, 0.1)
        Ellipse:
            pos: self.center_x - 200, self.center_y - 200
            size: 400, 400
        
        # Rays (Simulated)
        Color:
            rgba: Theme.color(Theme.SECONDARY, 0.05)
        Line:
            points: [self.center_x, self.center_y, 0, 0]
            width: 2
        Line:
            points: [self.center_x, self.center_y, self.width, 0]
            width: 2
        Line:
            points: [self.center_x, self.center_y, 0, self.height]
            width: 2
        Line:
            points: [self.center_x, self.center_y, self.width, self.height]
            width: 2

    BoxLayout:
        orientation: "vertical"
        padding: "24dp"
        spacing: "24dp"

        # --- Header ---
        Label:
            text: "MISSION REPORT"
            font_size: "14sp"
            letter_spacing: 3
            color: Theme.color(Theme.TEXT_SECONDARY)
            size_hint_y: None
            height: "20dp"

        Label:
            text: "QUIZ COMPLETE"
            font_size: Theme.FONT_H1
            bold: True
            font_name: "Roboto"
            color: Theme.color(Theme.TEXT_PRIMARY)
            size_hint_y: None
            height: "40dp"

        # --- Score Card ---
        GlassCard:
            orientation: "vertical"
            size_hint_y: None
            height: "220dp"
            padding: "32dp"
            spacing: "16dp"
            
            canvas.after:
                Color:
                    rgba: Theme.color(Theme.ACCENT_TEAL, 0.6)
                Line:
                    rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]
                    width: dp(2)

            Label:
                text: root.score_text 
                font_size: "48sp"
                bold: True
                color: Theme.color(Theme.ACCENT_TEAL)
            
            Label:
                text: root.encouragement_text
                font_size: "18sp"
                color: Theme.color(Theme.TEXT_PRIMARY)
                halign: "center"
                text_size: self.width, None

        # --- Buttons ---
        BoxLayout:
            size_hint_y: None
            height: "64dp"
            spacing: "16dp"
            
            GhostButton:
                text: "HOME"
                on_release: app.go_home()
            
            NeonButton:
                text: "PLAY AGAIN"
                on_release: app.go_quiz_setup()

        # --- Review Actions ---
        BoxLayout:
            size_hint_y: None
            height: "48dp"
            spacing: "16dp"
            
            GhostButton:
                text: "Review Answers üìù"
                on_release: root.open_review(filter_mistakes=False)
            
            GhostButton:
                text: "Learn from Mistakes üß†"
                on_release: root.open_review(filter_mistakes=True)

<ReviewPopup>:
    size_hint: 0.9, 0.9
    title: "Quiz Review"
    separator_color: Theme.color(Theme.PRIMARY)
    background_color: Theme.color(Theme.BG_DARK)
    
    BoxLayout:
        orientation: "vertical"
        padding: "12dp"
        spacing: "12dp"
        
        ScrollView:
            BoxLayout:
                id: review_list
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: "20dp"
                padding: "10dp"

        Button:
            text: "Close"
            size_hint_y: None
            height: "50dp"
            background_color: Theme.color(Theme.ACCENT_RED)
            on_release: root.dismiss()

<ReviewItem>:
    size_hint_y: None
    height: self.minimum_height
    orientation: "vertical"
    padding: "16dp"
    spacing: "8dp"
    
    canvas.before:
        Color:
            rgba: Theme.color(Theme.BG_CARD)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [12]
            
    Label:
        text: root.question_text
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]
        bold: True
        color: Theme.color(Theme.TEXT_PRIMARY)
        
    Label:
        text: root.answer_text
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]
        markup: True
        color: Theme.color(Theme.TEXT_SECONDARY)
        
    Label:
        text: root.explanation_text
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]
        font_size: "13sp"
        italic: True
        color: Theme.color(Theme.PRIMARY)

    GhostButton:
        text: "Ask AI deeper about this... ü§ñ"
        size_hint_y: None
        height: "36dp"
        font_size: "12sp"
        on_release: app.ask_about_review_item(root.question_text, root.answer_text)
