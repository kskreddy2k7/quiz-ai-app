#:import Theme app.ui.theme.Theme
#:include app/ui/components.kv

<ReviewItem>:
    orientation: "vertical"
    size_hint_y: None
    height: self.minimum_height
    padding: dp(10)
    spacing: dp(5)
    canvas.before:
        Color:
            rgba: Theme.get_color(Theme.BG_CARD)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(8)]

    Label:
        text: root.question_text
        color: Theme.get_color(Theme.TEXT_PRIMARY)
        font_name: Theme.FONT_HEADINGS
        font_size: "14sp"
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]
    
    Label:
        text: root.answer_text
        markup: True
        font_size: "13sp"
        text_size: self.width, None
        size_hint_y: None
        height: self.texture_size[1]

<ReviewPopup>:
    title: "Review"
    title_font: Theme.FONT_HEADINGS
    separator_color: Theme.get_color(Theme.PRIMARY_START)
    size_hint: 0.9, 0.9
    BoxLayout:
        orientation: "vertical"
        ScrollView:
            BoxLayout:
                id: review_list
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(10)
                padding: dp(10)

<ResultsScreen>:
    canvas.before:
        Color:
            rgba: Theme.get_color(Theme.BG_DARK)
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"
        padding: dp(30)
        spacing: dp(24)

        Label:
            text: "Quiz Complete!"
            font_size: Theme.H1_SIZE
            font_name: Theme.FONT_HEADINGS
            color: Theme.get_color(Theme.TEXT_PRIMARY)
            size_hint_y: None
            height: dp(40)

        # Score Circle (Simplified as text for now, could be canvas arc)
        BoxLayout:
            size_hint_y: None
            height: dp(150)
            canvas.before:
                Color:
                    rgba: Theme.get_color(Theme.PRIMARY_START, 0.2)
                Ellipse:
                    pos: self.center_x - dp(70), self.center_y - dp(70)
                    size: dp(140), dp(140)
            
            Label:
                text: root.score_text
                font_size: "24sp"
                bold: True
                color: Theme.get_color(Theme.ACCENT_CYAN)
        
        Label:
            text: root.encouragement_text
            font_size: "18sp"
            color: Theme.get_color(Theme.TEXT_SECONDARY)
            size_hint_y: None
            height: dp(30)

        BoxLayout:
            spacing: dp(10)
            size_hint_y: None
            height: dp(50)
            
            AccentButton:
                text: "Review Mistakes"
                on_release: root.open_review(filter_mistakes=True)
            AccentButton:
                text: "Review All"
                on_release: root.open_review(filter_mistakes=False)

        PrimaryButton:
            text: "Back to Home üè†"
            size_hint_y: None
            height: dp(56)
            on_release: app.go_home()
