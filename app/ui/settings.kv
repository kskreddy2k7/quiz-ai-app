#:import Theme app.ui.theme.Theme
#:include app/ui/components.kv

<SettingsScreen>:
    canvas.before:
        Color:
            rgba: Theme.get_color(Theme.BG_DARK)
        Rectangle:
            pos: self.pos
            size: self.size
        # Background Detail
        Color:
            rgba: Theme.get_color(Theme.PRIMARY_START, 0.05)
        Line:
            circle: (self.center_x, self.center_y, dp(300))
            width: dp(1)

    BoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(20)

        # --- Header ---
        BoxLayout:
            size_hint_y: None
            height: dp(48)
            spacing: dp(12)
            Button:
                text: "‚Üê Back"
                size_hint: None, None
                size: dp(80), dp(44)
                background_normal: ""
                background_color: 0,0,0,0
                font_name: Theme.FONT_BUTTON
                color: Theme.get_color(Theme.TEXT_SECONDARY)
                on_release: app.go_home()
                canvas.before:
                    Color:
                        rgba: Theme.get_color(Theme.CARD_DARK)
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8)]
            
            Label:
                text: "SETTINGS"
                font_size: Theme.H2_SIZE
                bold: True
                font_name: Theme.FONT_HEADINGS
                color: Theme.get_color(Theme.TEXT_PRIMARY)
                halign: "left"
                valign: "middle"
                text_size: self.size

        # --- API Key Section ---
        KVCard:
            size_hint_y: None
            height: dp(220)
            padding: dp(20)
            spacing: dp(16)
            orientation: "vertical"

            Label:
                text: "AI CONFIGURATION"
                font_size: "12sp"
                bold: True
                font_name: Theme.FONT_BUTTON
                color: Theme.get_color(Theme.ACCENT_CYAN)
                size_hint_y: None
                height: dp(20)
                halign: "left"
                text_size: self.width, None

            Label:
                text: "Gemini API Key"
                font_size: "14sp"
                color: Theme.get_color(Theme.TEXT_PRIMARY)
                size_hint_y: None
                height: dp(20)
                halign: "left"
                text_size: self.width, None
                font_name: Theme.FONT_BODY

            InputBox:
                id: api_key_input
                hint_text: "AIzaSy..."
                password: True
                multiline: False
                on_text: root.api_key = self.text

            AccentButton:
                text: "Save Key üíæ"
                size_hint_y: None
                height: dp(44)
                on_release: root.save_key()

        # --- Status ---
        Label:
            text: root.status_text
            font_size: "14sp"
            color: Theme.get_color(Theme.ACCENT_CYAN)
            size_hint_y: None
            height: dp(40)
            opacity: 1 if root.status_text else 0

        Widget:
            # Spacer
